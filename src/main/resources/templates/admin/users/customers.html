<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/dashboard_layout}">
<head>
    <title>Customers Management - EcoSwap</title>
</head>
<body>

<!-- Page-specific CSS -->
<th:block layout:fragment="stylesheets">
    <link th:href="@{/css/admin-users.css}" rel="stylesheet"/>
</th:block>

<div layout:fragment="content">
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-content">
            <div>
                <h1>Customers Management</h1>
                <p class="subtitle">Manage all customers on the platform</p>
            </div>
            <a th:href="@{/admin/users}" class="btn btn-secondary">
                <i class="fas fa-users"></i> All Users
            </a>
        </div>
    </div>

    <!-- Flash Messages -->
    <div th:if="${successMessage}" class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        <span th:text="${successMessage}"></span>
    </div>
    <div th:if="${errorMessage}" class="alert alert-error">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${errorMessage}"></span>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon customers">
                <i class="fas fa-user"></i>
            </div>
            <div class="stat-info">
                <span class="stat-label">Total Customers</span>
                <span class="stat-value" th:text="${totalCustomers}">0</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon active">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-info">
                <span class="stat-label">Active Customers</span>
                <span class="stat-value" th:text="${customers.?[enabled == true].size()}">0</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon inactive">
                <i class="fas fa-user-slash"></i>
            </div>
            <div class="stat-info">
                <span class="stat-label">Inactive Customers</span>
                <span class="stat-value" th:text="${customers.?[enabled == false].size()}">0</span>
            </div>
        </div>
    </div>

    <!-- Filters and Search -->
    <div class="filters-card">
        <form th:action="@{/admin/users/customers}" method="get" class="filters-form">
            <div class="search-box-large">
                <i class="fas fa-search"></i>
                <input type="text" name="search" th:value="${searchQuery}" placeholder="Search by name, email...">
                <button type="submit" class="btn-search">Search</button>
            </div>
            <a th:href="@{/admin/users/customers}" class="btn-reset">
                <i class="fas fa-redo"></i> Reset
            </a>
        </form>
    </div>

    <!-- Customers Table -->
    <div class="users-table-card">
        <div class="table-header">
            <h3><i class="fas fa-user"></i> Customers List</h3>
            <span class="record-count" th:text="'Showing ' + ${customers.size()} + ' of ' + ${totalItems} + ' customers'">Showing 15 of 100 customers</span>
        </div>
        <div class="table-wrapper">
            <table class="users-table">
                <thead>
                    <tr>
                        <th>Customer Info</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Address</th>
                        <th>Status</th>
                        <th>Joined</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="customer : ${customers}">
                        <td>
                            <div class="user-info-cell">
                                <div class="user-avatar-small">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div>
                                    <strong th:text="${customer.fullName}">Customer Name</strong>
                                    <small th:text="'ID: ' + ${customer.id}">ID: 123</small>
                                </div>
                            </div>
                        </td>
                        <td th:text="${customer.email}">email@example.com</td>
                        <td>
                            <span th:if="${customer.phoneNumber != null}" th:text="${customer.phoneNumber}">Phone</span>
                            <span th:unless="${customer.phoneNumber != null}" class="text-muted">-</span>
                        </td>
                        <td>
                            <span th:if="${customer.address != null}" th:text="${customer.address}">Address</span>
                            <span th:unless="${customer.address != null}" class="text-muted">-</span>
                        </td>
                        <td>
                            <span class="status-badge" th:classappend="${customer.enabled} ? 'active' : 'inactive'"
                                  th:text="${customer.enabled ? 'Active' : 'Disabled'}">Active</span>
                        </td>
                        <td th:text="${#temporals.format(customer.createdAt, 'MMM dd, yyyy')}">Jan 01, 2024</td>
                        <td>
                            <div class="action-buttons">
                                <a th:href="@{/admin/users/{id}(id=${customer.id})}" class="btn-action btn-view" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <form th:action="@{/admin/users/{id}/toggle-status(id=${customer.id})}" method="post" style="display: inline;">
                                    <button type="submit" class="btn-action btn-toggle" th:title="${customer.enabled ? 'Disable' : 'Enable'}">
                                        <i th:class="${customer.enabled ? 'fas fa-ban' : 'fas fa-check'}"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(customers)}">
                        <td colspan="7" class="text-center empty-state">
                            <i class="fas fa-user"></i>
                            <p>No customers found</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination" th:if="${totalPages > 1}">
            <a th:href="@{/admin/users/customers(page=${currentPage - 1}, search=${searchQuery})}"
               th:classappend="${currentPage == 0} ? 'disabled' : ''"
               class="page-btn">
                <i class="fas fa-chevron-left"></i> Previous
            </a>

            <div class="page-numbers">
                <a th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                   th:if="${i >= currentPage - 2 and i <= currentPage + 2}"
                   th:href="@{/admin/users/customers(page=${i}, search=${searchQuery})}"
                   th:text="${i + 1}"
                   th:classappend="${i == currentPage} ? 'active' : ''"
                   class="page-number">1</a>
            </div>

            <a th:href="@{/admin/users/customers(page=${currentPage + 1}, search=${searchQuery})}"
               th:classappend="${currentPage >= totalPages - 1} ? 'disabled' : ''"
               class="page-btn">
                Next <i class="fas fa-chevron-right"></i>
            </a>
        </div>
    </div>
</div>

</body>
</html>
