<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/dashboard_layout}">
<head>
    <title>Seller Dashboard - EcoSwap</title>
    <link th:href="@{/css/sellerpage.css}" rel="stylesheet"/>
</head>
<body>

<div layout:fragment="content">
    <!-- Page Header -->
    <div class="page-header">
        <h1>Welcome to EcoSwap Dashboard</h1>
        <p class="subtitle">Here's an overview of your sustainable marketplace performance</p>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
        <!-- Products Card -->
        <div class="stat-card products">
            <div class="stat-icon">
                <i class="fas fa-box"></i>
            </div>
            <div class="stat-content">
                <h3>Total Products</h3>
                <p class="stat-value" th:text="${totalProducts}">150</p>
                <span class="stat-change positive">
                    <i class="fas fa-check-circle"></i> <span th:text="${activeProducts}">0</span> active
                </span>
            </div>
        </div>

        <!-- Revenue Card -->
        <div class="stat-card users">
            <div class="stat-icon">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="stat-content">
                <h3>Total Revenue</h3>
                <p class="stat-value">$<span th:text="${#numbers.formatDecimal(totalRevenue, 1, 2)}">0.00</span></p>
                <span class="stat-change positive">
                    <i class="fas fa-arrow-up"></i> Lifetime earnings
                </span>
            </div>
        </div>

        <!-- Orders Card -->
        <div class="stat-card orders">
            <div class="stat-icon">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="stat-content">
                <h3>Total Orders</h3>
                <p class="stat-value" th:text="${totalOrders}">120</p>
                <span class="stat-change" th:classappend="${pendingOrders > 0 ? 'positive' : ''}">
                    <i class="fas fa-clock"></i> <span th:text="${pendingOrders}">0</span> pending
                </span>
            </div>
        </div>

        <!-- CO2 Saved Card -->
        <div class="stat-card revenue">
            <div class="stat-icon">
                <i class="fas fa-leaf"></i>
            </div>
            <div class="stat-content">
                <h3>CO‚ÇÇ Saved</h3>
                <p class="stat-value"><span th:text="${#numbers.formatDecimal(totalCo2Saved, 1, 2)}">35</span> <span style="font-size: 1rem;">kg</span></p>
                <span class="stat-change positive">
                    <i class="fas fa-arrow-up"></i> Making impact!
                </span>
            </div>
        </div>
    </div>

    <!-- Environmental Impact Section -->
    <div class="impact-section">
        <div class="section-header">
            <h2>üåø Your Environmental Impact</h2>
            <span class="eco-badge">Making a Difference</span>
        </div>
        <div class="impact-grid">
            <div class="impact-card">
                <div class="impact-icon green">
                    <i class="fas fa-globe-americas"></i>
                </div>
                <h3>Carbon Footprint</h3>
                <p class="impact-value"><span th:text="${#numbers.formatDecimal(totalCo2Saved, 1, 2)}">0</span> kg</p>
                <p class="impact-desc">CO‚ÇÇ emissions saved through sustainable products</p>
            </div>
            <div class="impact-card">
                <div class="impact-icon blue">
                    <i class="fas fa-recycle"></i>
                </div>
                <h3>Items Sold</h3>
                <p class="impact-value" th:text="${itemsRecycled ?: 0}">0</p>
                <p class="impact-desc">Products sold to customers</p>
            </div>
            <div class="impact-card">
                <div class="impact-icon emerald">
                    <i class="fas fa-recycle"></i>
                </div>
                <h3>Plastic Saved</h3>
                <p class="impact-value"><span th:text="${#numbers.formatDecimal(totalPlasticSaved, 1, 2)}">0</span> kg</p>
                <p class="impact-desc">Plastic waste prevented</p>
            </div>
        </div>
    </div>

    <!-- Charts and Data Section -->
    <div class="charts-section">
        <!-- Monthly Transactions Chart -->
        <div class="chart-card large">
            <div class="chart-header">
                <h2>Monthly Transactions</h2>
                <select class="period-selector">
                    <option>Last 6 Months</option>
                    <option>Last Year</option>
                    <option>All Time</option>
                </select>
            </div>
            <div class="chart-body" style="position: relative; height: 300px;">
                <canvas id="transactionsChart"></canvas>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="chart-card small">
            <div class="chart-header">
                <h2>Quick Stats</h2>
            </div>
            <div class="quick-stats-list">
                <div class="quick-stat-item">
                    <div class="quick-stat-info">
                        <i class="fas fa-chart-line" style="color: #1dbf73;"></i>
                        <div>
                            <p class="stat-label">Conversion Rate</p>
                            <p class="stat-number">3.2%</p>
                        </div>
                    </div>
                </div>
                <div class="quick-stat-item">
                    <div class="quick-stat-info">
                        <i class="fas fa-clock" style="color: #3b82f6;"></i>
                        <div>
                            <p class="stat-label">Avg. Response Time</p>
                            <p class="stat-number">2.5 hrs</p>
                        </div>
                    </div>
                </div>
                <div class="quick-stat-item">
                    <div class="quick-stat-info">
                        <i class="fas fa-star" style="color: #f59e0b;"></i>
                        <div>
                            <p class="stat-label">Average Rating</p>
                            <p class="stat-number">4.8/5</p>
                        </div>
                    </div>
                </div>
                <div class="quick-stat-item">
                    <div class="quick-stat-info">
                        <i class="fas fa-undo" style="color: #ef4444;"></i>
                        <div>
                            <p class="stat-label">Return Rate</p>
                            <p class="stat-number">2.1%</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Cards Section -->
    <div class="data-cards-section">
        <!-- Low Stock Products -->
        <div class="data-card">
            <div class="data-card-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Low Stock Products</h3>
                <a th:href="@{/dashboard/products}" class="view-all-link">View All ‚Üí</a>
            </div>
            <div class="data-card-body">
                <div th:if="${lowStockProducts.isEmpty()}" style="text-align: center; padding: 30px; color: #6b7280;">
                    <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 10px; color: #10b981;"></i>
                    <p>All products have sufficient stock!</p>
                </div>
                <div th:if="${!lowStockProducts.isEmpty()}" class="product-list">
                    <div class="product-item" th:each="product : ${lowStockProducts}" th:if="${productStat.index < 3}">
                        <div class="product-info">
                            <div class="product-icon" th:classappend="${product.stock == 0 ? 'danger' : 'warning'}">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="product-details">
                                <h4 th:text="${product.name}">Product Name</h4>
                                <p><span th:text="${product.stock}">0</span> units remaining</p>
                            </div>
                        </div>
                        <div class="product-badge" th:classappend="${product.stock == 0 ? 'danger' : 'warning'}">
                            <i class="fas fa-exclamation-circle"></i>
                            <span th:text="${product.stock == 0 ? 'Out of Stock' : 'Low Stock'}">Low Stock</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="data-card">
            <div class="data-card-header">
                <h3><i class="fas fa-shopping-cart"></i> Recent Orders</h3>
                <a th:href="@{/dashboard/orders}" class="view-all-link">View All ‚Üí</a>
            </div>
            <div class="data-card-body">
                <div th:if="${recentOrders.isEmpty()}" style="text-align: center; padding: 30px; color: #6b7280;">
                    <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.5;"></i>
                    <p>No orders yet</p>
                </div>
                <div th:if="${!recentOrders.isEmpty()}" class="user-list">
                    <div class="user-item" th:each="order : ${recentOrders}">
                        <div class="user-avatar" style="background: #1dbf73; color: white; display: flex; align-items: center; justify-content: center; width: 50px; height: 50px; border-radius: 50%; font-weight: bold;">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="user-info">
                            <h4 th:text="${order.orderNumber}">ORD-123</h4>
                            <p>
                                <span th:text="${order.customer.fullName}">Customer</span> -
                                $<span th:text="${#numbers.formatDecimal(order.totalAmount, 1, 2)}">0.00</span>
                            </p>
                        </div>
                        <div class="user-badge" th:classappend="${order.status.name() == 'PENDING' ? 'warning' : (order.status.name() == 'DELIVERED' ? 'success' : '')}">
                            <span th:text="${order.status.displayName}">Pending</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h2>Quick Actions</h2>
        <div class="actions-grid">
            <a th:href="@{/dashboard/products/add}" class="action-card">
                <div class="action-icon">‚ûï</div>
                <h3>Add Product</h3>
                <p>List a new sustainable product</p>
            </a>
            <a th:href="@{/dashboard/orders}" class="action-card">
                <div class="action-icon">üì¶</div>
                <h3>Manage Orders</h3>
                <p>View and process orders</p>
            </a>
            <a th:href="@{/dashboard/customers}" class="action-card">
                <div class="action-icon">üë•</div>
                <h3>View Customers</h3>
                <p>Manage customer relationships</p>
            </a>
            <a th:href="@{/dashboard/reports}" class="action-card">
                <div class="action-icon">üìä</div>
                <h3>Generate Report</h3>
                <p>Analytics and insights</p>
            </a>
        </div>
    </div>
</div>

<div layout:fragment="scripts">
<script>
    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, initializing chart...');
        
        // Check if Chart.js is loaded
        if (typeof Chart === 'undefined') {
            console.error('Chart.js not loaded!');
            document.getElementById('transactionsChart').parentElement.innerHTML = 
                '<div style="text-align: center; padding: 50px; color: #999;">Chart library failed to load. Please refresh the page.</div>';
            return;
        }
        
        // Monthly Transactions Chart
        const ctx = document.getElementById('transactionsChart');
        
        if (!ctx) {
            console.error('Canvas element not found');
            return;
        }
        
        console.log('Creating chart...');
        
        try {
            const myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['January', 'February', 'March', 'April', 'May'],
                    datasets: [{
                        label: 'Orders',
                        data: [10, 20, 15, 25, 30],
                        backgroundColor: 'rgba(29, 191, 115, 0.8)',
                        borderColor: '#1dbf73',
                        borderWidth: 2,
                        borderRadius: 8,
                        hoverBackgroundColor: 'rgba(29, 191, 115, 1)',
                        hoverBorderColor: '#17a05d',
                        hoverBorderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 14,
                                    family: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                                    weight: '500'
                                },
                                color: '#333'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 13
                            },
                            cornerRadius: 8,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y + ' orders';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#666',
                                font: {
                                    size: 12
                                },
                                padding: 10,
                                stepSize: 5
                            }
                        },
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#666',
                                font: {
                                    size: 12
                                },
                                padding: 10
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                }
            });

            console.log('‚úÖ Chart initialized successfully:', myChart);
        } catch (error) {
            console.error('‚ùå Error creating chart:', error);
            ctx.parentElement.innerHTML =
                '<div style="text-align: center; padding: 50px; color: #ef4444;">Error loading chart. Please check console.</div>';
        }
    });
</script>
</div>

</body>
</html>